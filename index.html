<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat by Fan</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì±</text></svg>">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getDatabase, ref, set, onValue, push, update, remove, get, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        // Firebase configuration - REPLACE WITH YOUR OWN CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCU-2Oa0zjmzyAnBIrluPQbrf2t-lPiikg",
            authDomain: "chatbyfan.firebaseapp.com",
            databaseURL: "https://chatbyfan-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chatbyfan",
            storageBucket: "chatbyfan.firebasestorage.app",
            messagingSenderId: "844332208537",
            appId: "1:844332208537:web:5b2747debe491ec8610308"
        };

        console.log('Firebase config loaded:', firebaseConfig.projectId);

        // Initialize Firebase
        console.log('Initializing Firebase app...');
        const app = initializeApp(firebaseConfig);
        console.log('Firebase app initialized');

        const auth = getAuth(app);
        console.log('Firebase Auth initialized');

        const database = getDatabase(app);
        console.log('Firebase Database initialized');

        const storage = getStorage(app);
        console.log('Firebase Storage initialized');

        // Test Firebase connection
        console.log('Testing Firebase connection...');
        try {
            // Test database connection
            const testRef = ref(database, '.info/connected');
            onValue(testRef, (snap) => {
                if (snap.val() === true) {
                    console.log('‚úÖ Firebase database connected successfully');
                } else {
                    console.log('‚ùå Firebase database connection failed');
                }
            });
        } catch (error) {
            console.error('Firebase connection test failed:', error);
        }

        // Make Firebase functions available globally
        window.auth = auth;
        window.database = database;
        window.storage = storage;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.dbRef = ref;
        window.set = set;
        window.onValue = onValue;
        window.push = push;
        window.update = update;
        window.remove = remove;
        window.get = get;
        window.query = query;
        window.orderByChild = orderByChild;
        window.limitToLast = limitToLast;
        window.storageRef = storageRef;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
    </script>
</head>
<body>
    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Chat by Fan</h1>
                <p>–ë—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>–í—Ö–æ–¥</h2>
                <input type="text" id="loginUsername" placeholder="–ù–∏–∫–Ω–µ–π–º" required>
                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button id="loginBtn" class="auth-btn">–í–æ–π—Ç–∏</button>
                <p class="auth-switch">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="showRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <input type="text" id="registerUsername" placeholder="–ù–∏–∫–Ω–µ–π–º" required>
                <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button id="registerBtn" class="auth-btn">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                <p class="auth-switch">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–í–æ–π—Ç–∏</a></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- User Profile -->
            <div class="user-profile">
                <div class="user-avatar">
                    <img id="userAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjNjY2NjY2Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDAiPkDwn5iKPC90ZXh0Pgo8L3N2Zz4=" alt="Avatar">
                </div>
                <div class="user-info">
                    <div class="user-name" id="userDisplayName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div class="user-status">–æ–Ω–ª–∞–π–Ω</div>
                </div>
                <button class="settings-btn" id="settingsBtn">‚öôÔ∏è</button>
            </div>

            <!-- Search -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤..." class="search-input">
            </div>

            <!-- Chats List -->
            <div class="chats-list" id="chatsList">
                <!-- Chats will be loaded here -->
            </div>

            <!-- New Chat Button -->
            <button class="new-chat-btn" id="newChatBtn">
                <span class="plus-icon">+</span>
                –ù–æ–≤—ã–π —á–∞—Ç
            </button>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üí¨</div>
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h2>
                <p>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏</p>
            </div>

            <!-- Chat Header -->
            <div class="chat-header" id="chatHeader" style="display: none;">
                <div class="chat-avatar">
                    <img id="chatAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjNjY2NjY2Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDAiPkDwn5iKPC90ZXh0Pgo8L3N2Zz4=" alt="Chat Avatar">
                </div>
                <div class="chat-info">
                    <div class="chat-name" id="chatName">–ß–∞—Ç</div>
                    <div class="chat-status" id="chatStatus">–±—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ</div>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be loaded here -->
            </div>

            <!-- Message Input -->
            <div class="message-input-container" id="messageInputContainer" style="display: none;">
                <div class="message-input-wrapper">
                    <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." class="message-input">
                    <button class="send-btn" id="sendBtn"><img src="https://png.pngtree.com/png-vector/20250605/ourmid/pngtree-white-paper-airplane-in-flight-isolated-on-transparent-png-image_16468361.png" alt="Send" style="width: 20px; height: 20px;"></button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modals -->
    <div class="modal" id="newChatModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ù–æ–≤—ã–π —á–∞—Ç</h3>
                <button class="close-modal" id="closeNewChatModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="newChatUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="modal-input">
                <button id="startNewChatBtn" class="modal-btn">–ù–∞—á–∞—Ç—å —á–∞—Ç</button>
            </div>
        </div>
    </div>

    <!-- FAQ Button -->
    <button id="faqBtn" class="faq-btn">?</button>

    <!-- FAQ Modal -->
    <div id="faqModal" class="modal" style="display: none;">
        <div class="modal-content faq-modal-content">
            <div class="modal-header">
                <h3>–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <button class="close-modal" id="closeFaqModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="faq-content">
                    <p><strong>–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—à—É –Ω–µ –ø–∏—Å–∞—Ç—å –∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∏—á–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ —Å–∫—Ä—ã—Ç—å –æ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ª–∏—Ü.</strong></p>
                    <p><strong>–°–∞–π—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∏–º–µ–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–¥!</strong></p>
                    <div class="faq-warning">
                        ‚ö†Ô∏è <strong>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:</strong> –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∏–¥–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∏ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS LOADED INLINE FOR TESTING -->
    <script>
        console.log('=== LOADING SCRIPTS INLINE ===');

        // Load script.js inline
        console.log('Loading script.js...');
        // Copy the entire script.js content here
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== DOM CONTENT LOADED ===');
            console.log('Chat by Fan initializing...');

            // Wait for all scripts to load
            setTimeout(() => {
                console.log('Initializing modules after timeout...');

                // Initialize all modules in correct order
                if (typeof window.initAuth === 'function') {
                    console.log('Calling initAuth...');
                    window.initAuth();
                    console.log('‚úÖ Auth module initialized');
                } else {
                    console.error('‚ùå initAuth function not found');
                }

                if (typeof window.initUI === 'function') {
                    console.log('Calling initUI...');
                    window.initUI();
                    console.log('‚úÖ UI module initialized');
                } else {
                    console.error('‚ùå initUI function not found');
                }

                // Chat will be initialized after authentication
                console.log('‚úÖ All modules loaded successfully');
            }, 1000); // Wait 1 second for all scripts to load
        });
        console.log('script.js loaded inline');
    </script>

    <script>
        // Load auth.js inline
        console.log('Loading auth.js...');
        // Copy auth.js content here
        let currentUser = null;

        const authScreenElement = document.getElementById('authScreen');
        const appElement = document.getElementById('app');
        const loginFormElement = document.getElementById('loginForm');
        const registerFormElement = document.getElementById('registerForm');
        const loginBtnElement = document.getElementById('loginBtn');
        const registerBtnElement = document.getElementById('registerBtn');
        const showRegisterElement = document.getElementById('showRegister');
        const showLoginElement = document.getElementById('showLogin');
        const loginUsernameElement = document.getElementById('loginUsername');
        const loginPasswordElement = document.getElementById('loginPassword');
        const registerUsernameElement = document.getElementById('registerUsername');
        const registerPasswordElement = document.getElementById('registerPassword');

        function initAuth() {
            console.log('=== INIT AUTH START ===');

            if (!window.auth || !window.database) {
                console.error('‚ùå Firebase not loaded!');
                return;
            }

            console.log('‚úÖ Firebase is available');

            window.onAuthStateChanged(window.auth, (user) => {
                console.log('üîÑ Auth state changed:', user ? 'logged in' : 'logged out');
                if (user) {
                    currentUser = user;
                    console.log('üë§ User logged in:', user.uid);
                    if (authScreenElement && appElement) {
                        authScreenElement.style.display = 'none';
                        appElement.style.display = 'flex';
                    }
                } else {
                    currentUser = null;
                    console.log('üö™ User logged out');
                    if (authScreenElement && appElement) {
                        authScreenElement.style.display = 'flex';
                        appElement.style.display = 'none';
                    }
                }
            });

            console.log('üéß Setting up event listeners...');
            setupEventListeners();
            console.log('‚úÖ Auth initialization complete');
        }

        function setupEventListeners() {
            console.log('üéß Setting up auth event listeners...');

            if (loginBtnElement) {
                loginBtnElement.addEventListener('click', (e) => {
                    console.log('üîµ Login button clicked');
                    e.preventDefault();
                    handleLogin();
                });
                console.log('‚úÖ Login button listener added');
            } else {
                console.error('‚ùå loginBtnElement not found!');
            }

            if (registerBtnElement) {
                registerBtnElement.addEventListener('click', (e) => {
                    console.log('üü¢ Register button clicked');
                    e.preventDefault();
                    handleRegister();
                });
                console.log('‚úÖ Register button listener added');
            } else {
                console.error('‚ùå registerBtnElement not found!');
            }

            console.log('‚úÖ Auth event listeners setup complete');
        }

        function handleLogin() {
            console.log('üö™ Handling login...');
            alert('Login function called!');
        }

        function handleRegister() {
            console.log('üìù Handling register...');
            alert('Register function called!');
        }

        window.initAuth = initAuth;
        console.log('auth.js loaded inline');
    </script>

    <script>
        // Load ui.js inline
        console.log('Loading ui.js...');

        function initUI() {
            console.log('Initializing UI module...');
            console.log('UI module initialized successfully');
        }

        window.initUI = initUI;
        console.log('ui.js loaded inline');
    </script>

    <!-- Emergency test buttons -->
    <script>
        // Add test buttons to page
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üö® Adding emergency test buttons...');
            const testDiv = document.createElement('div');
            testDiv.innerHTML = `
                <div style="position: fixed; top: 10px; left: 10px; z-index: 9999; background: yellow; padding: 10px; border: 2px solid red; font-family: monospace; font-size: 12px;">
                    <div style="margin-bottom: 5px; font-weight: bold;">EMERGENCY TESTS:</div>
                    <button onclick="console.log('üö® EMERGENCY: Login test'); const btn = document.getElementById('loginBtn'); if(btn){console.log('Found loginBtn, clicking...'); btn.click();}else{console.error('loginBtn not found!');}">TEST LOGIN</button>
                    <button onclick="console.log('üö® EMERGENCY: Register test'); const btn = document.getElementById('registerBtn'); if(btn){console.log('Found registerBtn, clicking...'); btn.click();}else{console.error('registerBtn not found!');}">TEST REGISTER</button>
                    <button onclick="console.log('üö® EMERGENCY: FAQ test'); const btn = document.getElementById('faqBtn'); if(btn){console.log('Found faqBtn, clicking...'); btn.click();}else{console.error('faqBtn not found!');}">TEST FAQ</button>
                    <button onclick="console.log('üö® EMERGENCY: Auth init'); if(typeof window.initAuth === 'function'){console.log('Calling initAuth...'); window.initAuth();}else{console.error('initAuth not found!');}">TEST AUTH INIT</button>
                    <button onclick="console.log('üö® EMERGENCY: UI init'); if(typeof window.initUI === 'function'){console.log('Calling initUI...'); window.initUI();}else{console.error('initUI not found!');}">TEST UI INIT</button>
                    <button onclick="console.log('üö® EMERGENCY: Check elements'); console.log('loginBtn:', !!document.getElementById('loginBtn')); console.log('registerBtn:', !!document.getElementById('registerBtn')); console.log('faqBtn:', !!document.getElementById('faqBtn'));">CHECK ELEMENTS</button>
                </div>
            `;
            document.body.appendChild(testDiv);
            console.log('‚úÖ Emergency test buttons added');
        });
    </script>

    <!-- Debug script to check if everything loads -->
    <script>
        window.addEventListener('load', () => {
            console.log('=== PAGE LOAD DEBUG ===');
            console.log('Firebase auth available:', !!window.auth);
            console.log('Firebase database available:', !!window.database);
            console.log('Auth functions available:', !!window.initAuth);
            console.log('Chat functions available:', !!window.initChat);
            console.log('UI functions available:', !!window.initUI);
            console.log('Notification function available:', !!window.showNotification);

            // Check DOM elements
            console.log('=== DOM ELEMENTS CHECK ===');
            console.log('loginBtn:', !!document.getElementById('loginBtn'));
            console.log('registerBtn:', !!document.getElementById('registerBtn'));
            console.log('sendBtn:', !!document.getElementById('sendBtn'));
            console.log('faqBtn:', !!document.getElementById('faqBtn'));
            console.log('settingsBtn:', !!document.getElementById('settingsBtn'));

            // Test button clicks manually
            setTimeout(() => {
                console.log('=== MANUAL BUTTON TEST ===');

                const loginBtn = document.getElementById('loginBtn');
                const registerBtn = document.getElementById('registerBtn');
                const faqBtn = document.getElementById('faqBtn');

                if (loginBtn) {
                    console.log('Testing login button click...');
                    loginBtn.click();
                }

                if (registerBtn) {
                    console.log('Testing register button click...');
                    registerBtn.click();
                }

                if (faqBtn) {
                    console.log('Testing FAQ button click...');
                    faqBtn.click();
                }

                console.log('=== MANUAL TEST COMPLETE ===');
            }, 2000);

            console.log('=== DEBUG COMPLETE ===');
        });
    </script>
</body>
</html>