<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FansChat">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6366f1">
    <title>FansChat - Ultra Secure</title>
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <!-- Security headers - Note: X-Frame-Options and CSP frame-ancestors should be set via HTTP headers in production -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src *; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; font-src *; img-src * data:; media-src * data:; connect-src *; frame-src *;">
    <link rel="icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getDatabase, ref, set, onValue, push, update, remove, get, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        // Firebase configuration - REPLACE WITH YOUR OWN CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCU-2Oa0zjmzyAnBIrluPQbrf2t-lPiikg",
            authDomain: "chatbyfan.firebaseapp.com",
            databaseURL: "https://chatbyfan-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chatbyfan",
            storageBucket: "chatbyfan.firebasestorage.app",
            messagingSenderId: "844332208537",
            appId: "1:844332208537:web:5b2747debe491ec8610308"
        };

        console.log('Firebase config loaded:', firebaseConfig.projectId);

        // Initialize Firebase
        console.log('Initializing Firebase app...');
        const app = initializeApp(firebaseConfig);
        console.log('Firebase app initialized');

        const auth = getAuth(app);
        console.log('Firebase Auth initialized');

        const database = getDatabase(app);
        console.log('Firebase Database initialized');

        const storage = getStorage(app);
        console.log('Firebase Storage initialized');

        // Make Firebase functions available globally
        window.auth = auth;
        window.database = database;
        window.storage = storage;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.dbRef = ref;
        window.set = set;
        window.onValue = onValue;
        window.push = push;
        window.update = update;
        window.remove = remove;
        window.get = get;
        window.query = query;
        window.orderByChild = orderByChild;
        window.limitToLast = limitToLast;
        window.storageRef = storageRef;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
    </script>
</head>
<body>
    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>FansChat</h1>
                <p>–ë—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>–í—Ö–æ–¥</h2>
                <input type="text" id="loginUsername" placeholder="–ù–∏–∫–Ω–µ–π–º" required>
                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button id="loginBtn" class="auth-btn">–í–æ–π—Ç–∏</button>
                <p class="auth-switch">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="showRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <input type="text" id="registerUsername" placeholder="–ù–∏–∫–Ω–µ–π–º" required>
                <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button id="registerBtn" class="auth-btn">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                <p class="auth-switch">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–í–æ–π—Ç–∏</a></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- User Profile -->
            <div class="user-profile">
                <div class="user-avatar">
                    <img id="userAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjNjY2NjY2Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDAiPkDwn5iKPC90ZXh0Pgo8L3N2Zz4=" alt="Avatar">
                </div>
                <div class="user-info">
                    <div class="user-name" id="userDisplayName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div class="user-status">–æ–Ω–ª–∞–π–Ω</div>
                </div>
                <button class="settings-btn" id="settingsBtn">‚öôÔ∏è</button>
            </div>

            <!-- Search -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤..." class="search-input">
            </div>

            <!-- Chats List -->
            <div class="chats-list" id="chatsList">
                <!-- Chats will be loaded here -->
            </div>

            <!-- New Chat Button -->
            <button class="new-chat-btn" id="newChatBtn">
                <span class="plus-icon">+</span>
                –ù–æ–≤—ã–π —á–∞—Ç
            </button>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üí¨</div>
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h2>
                <p>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏</p>
            </div>

            <!-- Chat Header -->
            <div class="chat-header" id="chatHeader" style="display: none;">
                <div class="chat-avatar">
                    <img id="chatAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjNjY2NjY2Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDAiPkDwn5iKPC90ZXh0Pgo8L3N2Zz4=" alt="Chat Avatar">
                </div>
                <div class="chat-info">
                    <div class="chat-name" id="chatName">–ß–∞—Ç</div>
                    <div class="chat-status" id="chatStatus">–±—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ</div>
                </div>
                <div class="chat-actions">
                    <button class="block-user-btn" id="blockUserBtn" title="–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" style="color: red;">üö´</button>
                    <button class="change-channel-avatar-btn" id="changeChannelAvatarBtn" title="–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –∫–∞–Ω–∞–ª–∞" style="display: none;">üñºÔ∏è</button>
                </div>
                <input type="file" id="channelAvatarInput" accept="image/*" style="display: none;">
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be loaded here -->
            </div>

            <!-- Message Input -->
            <div class="message-input-container" id="messageInputContainer" style="display: none;">
                <div class="message-input-wrapper">
                    <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." class="message-input">
                    <button class="attach-btn" id="attachBtn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">üìé</button>
                    <button class="paint-btn" id="paintBtn" title="–†–∏—Å–æ–≤–∞—Ç—å" style="display: none;">üñºÔ∏è</button>
                    <button class="voice-btn" id="voiceBtn" title="–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">üé§</button>
                    <button class="send-btn" id="sendBtn"><img src="https://png.pngtree.com/png-vector/20250605/ourmid/pngtree-white-paper-airplane-in-flight-isolated-on-transparent-png-image_16468361.png" alt="Send" style="width: 20px; height: 20px;"></button>
                </div>
            </div>
        </div>
    </div>


    <!-- FAQ Button -->
    <button class="faq-btn" id="faqBtn">?</button>

    <!-- FAQ Modal -->
    <div class="modal" id="faqModal" style="display: none;">
        <div class="modal-content faq-modal-content">
            <div class="modal-header">
                <h3>FAQ</h3>
                <button class="close-modal" id="closeFaqModal">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>–í–Ω–∏–º–∞–Ω–∏–µ! –°–∞–π—Ç –≤—Å–µ –µ—â–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ –±–∞–≥–æ–≤! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –µ—Å–ª–∏ –Ω–∞—à–ª–∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö —Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ –±–∞–≥–µ –º–Ω–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä—è–º–æ –Ω–∞ —Å–∞–π—Ç–µ (FanlloN)</strong></p>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="newChatModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ù–æ–≤—ã–π —á–∞—Ç</h3>
                <button class="close-modal" id="closeNewChatModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-type-selector">
                    <button id="createPrivateChatBtn" class="chat-type-btn active">–õ–∏—á–Ω—ã–π —á–∞—Ç</button>
                    <button id="createGroupChatBtn" class="chat-type-btn">–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç</button>
                </div>
                <div id="privateChatForm">
                    <input type="text" id="newChatUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="modal-input">
                    <button id="startNewChatBtn" class="modal-btn">–ù–∞—á–∞—Ç—å —á–∞—Ç</button>
                </div>
                <div id="groupChatForm" style="display: none;">
                    <input type="text" id="groupNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" class="modal-input">
                    <div class="group-members-section">
                        <h4>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã</h4>
                        <div id="groupMembersList" class="group-members-list">
                            <!-- Members will be added here -->
                        </div>
                        <input type="text" id="addMemberInput" placeholder="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞" class="modal-input">
                        <button id="addMemberBtn" class="add-member-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    <button id="createGroupBtn" class="modal-btn">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="groupSettingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã</h3>
                <button class="close-modal" id="closeGroupSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="group-avatar-section">
                    <h4>–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã</h4>
                    <div class="avatar-upload">
                        <div id="groupAvatarPreview" class="avatar-preview">
                            <img id="groupAvatarImg" src="" alt="Group Avatar" style="display: none;">
                            <div class="avatar-placeholder">üë•</div>
                        </div>
                        <input type="file" id="groupAvatarInput" accept="image/*" style="display: none;">
                        <button id="changeGroupAvatarBtn" class="avatar-upload-btn">–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
                    </div>
                </div>
                <div class="group-name-section">
                    <h4>–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</h4>
                    <input type="text" id="editGroupNameInput" class="modal-input">
                    <button id="saveGroupNameBtn" class="modal-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
                <div class="group-members-section">
                    <h4>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã</h4>
                    <div id="manageGroupMembersList" class="group-members-list">
                        <!-- Members will be added here -->
                    </div>
                    <input type="text" id="addNewMemberInput" placeholder="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞" class="modal-input">
                    <button id="addNewMemberBtn" class="add-member-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <div class="group-actions">
                    <button id="leaveGroupBtn" class="leave-group-btn">–ü–æ–∫–∏–Ω—É—Ç—å –≥—Ä—É–ø–ø—É</button>
                    <button id="deleteGroupBtn" class="delete-group-btn" style="display: none;">–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal" id="imageModal" style="display: none;">
        <div class="modal-content image-modal-content">
            <div class="modal-header">
                <button class="close-modal" id="closeImageModal">&times;</button>
            </div>
            <div class="modal-body">
                <img id="fullSizeImage" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%; max-height: 80vh; object-fit: contain;">
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal" style="display: none;">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button class="close-modal" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="appearance">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</button>
                    <button class="settings-tab" data-tab="avatar">–ê–≤–∞—Ç–∞—Ä</button>
                    <button class="settings-tab" data-tab="password">–ü–∞—Ä–æ–ª—å</button>
                    <button class="settings-tab" data-tab="privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</button>
                </div>

                <!-- Tab Content -->
                <div class="settings-content">
                    <!-- Appearance Tab -->
                    <div class="settings-tab-content active" id="appearanceTab">
                        <div class="setting-item">
                            <label>–¢–µ–º–∞</label>
                            <label class="switch">
                                <input type="checkbox" id="themeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Avatar Tab -->
                    <div class="settings-tab-content" id="avatarTab">
                        <div class="avatar-selection">
                            <h4>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</h4>
                            <div class="emoji-grid">
                                <button class="emoji-btn" data-emoji="üòò">üòò</button>
                                <button class="emoji-btn" data-emoji="ü§ë">ü§ë</button>
                                <button class="emoji-btn" data-emoji="ü§†">ü§†</button>
                                <button class="emoji-btn" data-emoji="üëΩ">üëΩ</button>
                                <button class="emoji-btn" data-emoji="üëª">üëª</button>
                                <button class="emoji-btn" data-emoji="üê∑">üê∑</button>
                                <button class="emoji-btn" data-emoji="üë≥‚Äç‚ôÇÔ∏è">üë≥‚Äç‚ôÇÔ∏è</button>
                                <button class="emoji-btn" data-emoji="üë©">üë©</button>
                                <button class="emoji-btn" data-emoji="üë®">üë®</button>
                                <button class="emoji-btn" data-emoji="ü§¥">ü§¥</button>
                            </div>
                            <div class="avatar-upload">
                                <button id="uploadAvatarBtn" class="modal-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                            </div>
                        </div>
                        <div class="display-name-section">
                            <h4>–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</h4>
                            <input type="text" id="displayNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è" class="modal-input" maxlength="50">
                            <p class="display-name-hint">–≠—Ç–æ –∏–º—è –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ —á–∞—Ç–µ</p>
                            <button id="saveDisplayNameBtn" class="modal-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è</button>
                        </div>
                    </div>

                    <!-- Password Tab -->
                    <div class="settings-tab-content" id="passwordTab">
                        <div class="password-change">
                            <input type="password" id="oldPassword" placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å" class="modal-input">
                            <input type="password" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" class="modal-input">
                            <input type="password" id="confirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" class="modal-input">
                            <button id="changePasswordBtn" class="modal-btn">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                        </div>
                    </div>

                    <!-- Privacy Tab -->
                    <div class="settings-tab-content" id="privacyTab">
                        <div class="privacy-settings">
                            <div class="setting-item">
                                <label>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                                <label class="switch">
                                    <input type="checkbox" id="notificationsToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>–ó–≤–æ–Ω–∫–∏</label>
                                <label class="switch">
                                    <input type="checkbox" id="callsToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item logout-item">
                                <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Modules -->
    <script src="security/core/security.js"></script>
    <script src="security/auth/authSecurity.js"></script>
    <script src="security/validation/inputValidation.js"></script>
    <script src="security/encryption/dataEncryption.js"></script>

    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script src="chat.js"></script>
    <script src="ui.js"></script>
</body>
</html>